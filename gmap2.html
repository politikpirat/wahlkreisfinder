<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml"> 
  <head> 
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
    <title>GMAPS Address to Polygon Verification</title> 
    <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAA4Uq00U_KzDKlyRUvjx5-UxSqLiRHl5Jo_65kjhE22myLnR5taRRSqnIWgGNo6xQJUoYHWOCHGgQNMg" 
            type="text/javascript"></script> 
    <script src="maps.google.polygon.containsLatLng.js" type="text/javascript"></script>
    <script type="text/javascript"> 
 
    var map;
    var geocoder;
    var polygon = null;
 
	var point;

    function initialize() {
      map = new GMap2(document.getElementById("map_canvas"));
      	map.setCenter(new GLatLng(52.5166667,13.4), 11);
      	map.addControl(new GLargeMapControl());
      	map.addControl(new GMapTypeControl());
	geocoder = new GClientGeocoder();
	
	var pami = new GGeoXml("http://blogtest.landesgeschaeftsstelle.de/gmap/pankow-mitte.kml");
	map.addOverlay(pami);
	
	var cwsprd = new GGeoXml("http://blogtest.landesgeschaeftsstelle.de/gmap/cwsprd.kml");
	map.addOverlay(cwsprd);

	var nktssz = new GGeoXml("http://blogtest.landesgeschaeftsstelle.de/gmap/nktssz.kml");
        map.addOverlay(nktssz);

	var limhtk = new GGeoXml("http://blogtest.landesgeschaeftsstelle.de/gmap/limhtk.kml");
        map.addOverlay(limhtk);


	document.getElementById("out").innerHTML = "";

	  var triangleCoords = [
            new google.maps.LatLng(52.52661, 13.35102),
            new google.maps.LatLng(52.5216917, 13.4108734),
            new google.maps.LatLng(52.5091103, 13.375733),
            new google.maps.LatLng(52.52661, 13.35102)
          ];


        polygon = new google.maps.Polygon(triangleCoords, "#000000", 1, 1, "#336699", 0.3);
        //map.addOverlay(polygon);

	GDownloadUrl("./pankow-mitte.kml", function(data) {
          var xml = GXml.parse(data);
          var places = xml.documentElement.getElementsByTagName("Placemark");
            
	  document.getElementById("out").innerHTML += places[1];
	});	
	}
 
    function addAddressToMap(response) {
      if (!response || response.Status.code != 200) {
        alert("Adresse nicht gefunden.");
      } else {
        place = response.Placemark[0];
	out_html = '' + place.Point.coordinates[1] + ', ' + place.Point.coordinates[0] + '<br />';
        point = new GLatLng(place.Point.coordinates[1],
                            place.Point.coordinates[0]);
        marker = new GMarker(point);
        var inPoly = polygon.containsLatLng(point);
	map.addOverlay(marker);
	html = place.address + '<br>' +
          '<b>Country code:</b> ' + place.AddressDetails.Country.CountryNameCode + '<br />' + out_html + inPoly;
        marker.openInfoWindowHtml(html);
      	
	GEvent.addListener(marker, "click", function() {
          marker.openInfoWindowHtml(html);
        });

	document.getElementById("out").innerHTML = html;
      }
    }
 
    // showLocation() is called when you click on the Search button
    // in the form.  It geocodes the address entered into the form
    // and adds a marker to the map at that location.
    function showLocation() {
      var address = document.forms[0].q.value;
      geocoder.getLocations(address, addAddressToMap);
    }

    function resetMap() {	
      	initialize();
	document.forms[0].q.value = "";
    }
 
    </script> 
  </head> 
 
  <body onload="initialize()"> 
  <div id="side" style="width:300px;float:left;display:block;">
    <form action="#" onsubmit="showLocation(); return false;"> 
      <p> 
        <b>Adresse:</b> 
        <input type="text" name="q" value="" class="address_input" size="40" /> 
        <input type="submit" name="find" value="suchen" /> 
      	<button id="reset_button" onclick="resetMap()" type="button">reset</button>
      </p> 
    </form>
	<div id="out" style="margin:0;"></div>
  </div><!--#side-->

	<div id="map_canvas" style="width: 800px; height: 600px; margin-left:350px;"></div>

 </body> 
</html> 
