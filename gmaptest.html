<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>GMAPS XML TEST</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA4Uq00U_KzDKlyRUvjx5-UxSTHPoTnxy8SI_ayF985HNy84D_URRYuxSk8Mx82w5du4Y_TdwFAvlYjQ"
            type="text/javascript"></script>
</head>
<body>
<div id="map_canvas" style="margin:0 auto;width: 800px; height: 600px"></div>
    
    	<div id="adressen">
	</div>	
	<div id="out">
	</div>

    <script type="text/javascript">
    //<![CDATA[

    if (GBrowserIsCompatible()) {
      var adressen_html = "";
      
      var gmarkers = [];
      var i = 0;
      
      // EIGENE MARKER
      var baseIcon = new GIcon();
      baseIcon.image = "http://www.google.com/mapfiles/marker.png";
      baseIcon.iconAnchor = new GPoint(20, 34);
      baseIcon.infoWindowAnchor = new GPoint(10, 17);

      function createMarker(point,name,html) {
        var marker = new GMarker(point, {icon:baseIcon});
	GEvent.addListener(marker, "click", function() {
	  marker.openInfoWindowHtml(html);
        });
        gmarkers[i] = marker;
        adressen_html += '<a href="javascript:openMarker(' + i + ')">' + name + '</a><br />';
        document.getElementById("adressen").innerHTML = adressen_html;
        i++;
        return marker;
      }

      function openMarker(i) {
        GEvent.trigger(gmarkers[i], "click");
	}

      var map = new GMap2(document.getElementById("map_canvas"));
      //map.addControl(new GLargeMapControl());
      //map.addControl(new GMapTypeControl());
      map.setCenter(new GLatLng(52.5166667,13.4), 10);
      var geocoder = new GClientGeocoder();

      var request = GXmlHttp.create();
      request.open("GET", "geocoding.xml", true);
      request.onreadystatechange = function() {
        if (request.readyState == 4) {
          var xmlDoc = GXml.parse(request.responseText);
          var markers = xmlDoc.documentElement.getElementsByTagName("marker");
          
          for (var i = 0; i < markers.length; i++) {
    		var label = markers[i].getAttribute("adresse");
    		var html = markers[i].getAttribute("adresse");
		var adresse = markers[i].getAttribute("adresse");
    		geoCoding( label, adresse, html );
	  }
        }
      }
      request.send(null);
      
      function geoCoding(name, address, html) {
		if (geocoder) {
			geocoder.getLatLng(
				address,
				function( point ) {
					var marker = createMarker(point, name, html);
					map.addOverlay( marker );
				}
			);
			
		}
      }
    }
    //]]>
    </script>
</body>
</html>
